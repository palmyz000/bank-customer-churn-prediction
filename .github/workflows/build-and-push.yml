name: Build and Push Docker Image

# ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Push ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Branch main
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest  # ‡∏Ç‡∏≠‡∏¢‡∏∑‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Ubuntu ‡∏Ç‡∏≠‡∏á GitHub ‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

    steps:
    # 1. ‡∏î‡∏∂‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏•‡∏á‡∏°‡∏≤
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ Docker Hub (‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ù‡∏≤‡∏Å‡πÑ‡∏ß‡πâ)
    - name: Login to Docker Hub
      uses: docker/login-action@v2
      with:
        username: ${{ secrets.DOCKERHUB_USERNAME }}
        password: ${{ secrets.DOCKERHUB_TOKEN }}

    # 3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Docker Buildx (‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢ Build ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô)
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2

    # 4. ‡∏™‡∏±‡πà‡∏á Build ‡πÅ‡∏•‡∏∞ Push ‡∏Ç‡∏∂‡πâ‡∏ô Docker Hub ‡πÄ‡∏•‡∏¢!
    - name: Build and push
      uses: docker/build-push-action@v4
      with:
        context: .                  # üëà ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å! ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏Å‡πâ (‡πÉ‡∏´‡πâ‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå)
        file: ./src/Dockerfile
        push: true
        tags: palmmeesak/bank-churn-api:latest